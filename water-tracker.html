<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hydrate ‚Äî Water Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a1628;
    --surface: #0f1f3d;
    --surface2: #162847;
    --water: #38bdf8;
    --water-deep: #0ea5e9;
    --water-glow: rgba(56, 189, 248, 0.25);
    --gold: #f4c842;
    --text: #e2eeff;
    --muted: #6b8cba;
    --danger: #f87171;
    --success: #34d399;
    --goal: 2.5;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'DM Mono', monospace;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
    position: relative;
  }

  /* Animated background blobs */
  body::before {
    content: '';
    position: fixed;
    width: 600px; height: 600px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(56,189,248,0.07) 0%, transparent 70%);
    top: -150px; right: -150px;
    animation: drift 8s ease-in-out infinite alternate;
    pointer-events: none;
  }
  body::after {
    content: '';
    position: fixed;
    width: 400px; height: 400px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(56,189,248,0.05) 0%, transparent 70%);
    bottom: -100px; left: -100px;
    animation: drift 10s ease-in-out infinite alternate-reverse;
    pointer-events: none;
  }

  @keyframes drift {
    from { transform: translate(0,0) scale(1); }
    to { transform: translate(30px, 20px) scale(1.1); }
  }

  .container {
    max-width: 480px;
    margin: 0 auto;
    padding: 40px 20px 80px;
    position: relative;
    z-index: 1;
  }

  /* Header */
  header {
    text-align: center;
    margin-bottom: 48px;
  }
  .header-icon {
    font-size: 36px;
    display: block;
    margin-bottom: 12px;
    animation: bob 3s ease-in-out infinite;
  }
  @keyframes bob {
    0%,100% { transform: translateY(0); }
    50% { transform: translateY(-6px); }
  }
  header h1 {
    font-family: 'Playfair Display', serif;
    font-size: 2.6rem;
    font-weight: 400;
    letter-spacing: -0.5px;
    color: var(--text);
  }
  header h1 em {
    color: var(--water);
    font-style: italic;
  }
  .date-label {
    margin-top: 8px;
    font-size: 0.7rem;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--muted);
  }

  /* Goal Setter */
  .goal-section {
    background: var(--surface);
    border: 1px solid rgba(56,189,248,0.12);
    border-radius: 16px;
    padding: 20px 24px;
    margin-bottom: 32px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
  }
  .goal-label {
    font-size: 0.68rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 4px;
  }
  .goal-display {
    font-size: 1.5rem;
    font-weight: 500;
    color: var(--gold);
  }
  .goal-controls {
    display: flex;
    gap: 8px;
    align-items: center;
  }
  .btn-small {
    width: 32px; height: 32px;
    border-radius: 50%;
    border: 1px solid rgba(56,189,248,0.3);
    background: transparent;
    color: var(--water);
    font-size: 1.2rem;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.2s;
    font-family: inherit;
  }
  .btn-small:hover {
    background: var(--water-glow);
    border-color: var(--water);
    transform: scale(1.1);
  }

  /* Wave Tank */
  .tank-wrapper {
    position: relative;
    margin-bottom: 40px;
    display: flex;
    justify-content: center;
  }
  .tank {
    width: 220px;
    height: 280px;
    border: 2px solid rgba(56,189,248,0.25);
    border-radius: 20px 20px 40px 40px;
    position: relative;
    overflow: hidden;
    background: rgba(10,22,40,0.8);
    box-shadow: 0 0 40px rgba(56,189,248,0.1), inset 0 0 40px rgba(0,0,0,0.3);
  }
  .water-fill {
    position: absolute;
    bottom: 0; left: 0; right: 0;
    background: linear-gradient(to top, #0369a1, #38bdf8);
    transition: height 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
    border-radius: 0 0 38px 38px;
  }
  .wave {
    position: absolute;
    top: -18px; left: -20px;
    width: 140%;
    height: 36px;
    background: rgba(56,189,248,0.5);
    border-radius: 50%;
    animation: wave 3s ease-in-out infinite;
  }
  .wave2 {
    top: -12px;
    animation: wave 4s ease-in-out infinite reverse;
    opacity: 0.4;
  }
  @keyframes wave {
    0%,100% { transform: translateX(-10px) scaleY(1); }
    50% { transform: translateX(10px) scaleY(1.2); }
  }
  .tank-percent {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    font-family: 'Playfair Display', serif;
    font-size: 2.8rem;
    font-weight: 700;
    color: var(--text);
    text-shadow: 0 2px 20px rgba(0,0,0,0.5);
    z-index: 5;
    pointer-events: none;
    mix-blend-mode: overlay;
    filter: brightness(3);
  }
  .tank-liters {
    position: absolute;
    bottom: 18px; left: 0; right: 0;
    text-align: center;
    font-size: 0.75rem;
    color: rgba(255,255,255,0.9);
    z-index: 5;
    pointer-events: none;
  }
  /* Bubbles */
  .bubble {
    position: absolute;
    border-radius: 50%;
    background: rgba(255,255,255,0.15);
    animation: rise linear infinite;
    z-index: 4;
  }
  @keyframes rise {
    0% { transform: translateY(0) scale(1); opacity: 0.6; }
    100% { transform: translateY(-300px) scale(0.5); opacity: 0; }
  }

  /* Stats row */
  .stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 32px;
  }
  .stat-card {
    background: var(--surface);
    border: 1px solid rgba(56,189,248,0.1);
    border-radius: 14px;
    padding: 18px;
    text-align: center;
    transition: transform 0.2s, border-color 0.2s;
  }
  .stat-card:hover {
    transform: translateY(-2px);
    border-color: rgba(56,189,248,0.3);
  }
  .stat-value {
    font-family: 'Playfair Display', serif;
    font-size: 1.6rem;
    font-weight: 700;
    margin-bottom: 4px;
  }
  .stat-value.blue { color: var(--water); }
  .stat-value.gold { color: var(--gold); }
  .stat-value.green { color: var(--success); }
  .stat-value.red { color: var(--danger); }
  .stat-label {
    font-size: 0.62rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
  }

  /* Reminder Banner */
  .reminder-banner {
    border-radius: 14px;
    padding: 16px 20px;
    margin-bottom: 32px;
    font-size: 0.82rem;
    line-height: 1.5;
    display: flex;
    align-items: center;
    gap: 12px;
    transition: all 0.4s;
    opacity: 0;
    transform: translateY(-8px);
  }
  .reminder-banner.show {
    opacity: 1;
    transform: translateY(0);
  }
  .reminder-banner.warn {
    background: rgba(248,113,113,0.1);
    border: 1px solid rgba(248,113,113,0.3);
    color: #fca5a5;
  }
  .reminder-banner.ok {
    background: rgba(52,211,153,0.1);
    border: 1px solid rgba(52,211,153,0.3);
    color: #6ee7b7;
  }
  .reminder-banner.neutral {
    background: rgba(56,189,248,0.08);
    border: 1px solid rgba(56,189,248,0.2);
    color: var(--water);
  }
  .banner-icon { font-size: 1.4rem; flex-shrink: 0; }

  /* Quick Add Buttons */
  .section-title {
    font-size: 0.65rem;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 14px;
  }
  .quick-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    margin-bottom: 28px;
  }
  .quick-btn {
    background: var(--surface);
    border: 1px solid rgba(56,189,248,0.15);
    border-radius: 12px;
    padding: 14px 8px;
    color: var(--text);
    font-family: 'DM Mono', monospace;
    font-size: 0.72rem;
    cursor: pointer;
    transition: all 0.25s;
    text-align: center;
    line-height: 1.4;
  }
  .quick-btn:hover {
    background: var(--water-glow);
    border-color: var(--water);
    color: var(--water);
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(56,189,248,0.15);
  }
  .quick-btn:active { transform: translateY(0) scale(0.96); }
  .quick-btn .amount { font-size: 1.1rem; font-weight: 500; display: block; }

  /* Custom input */
  .custom-row {
    display: flex;
    gap: 10px;
    margin-bottom: 32px;
  }
  .input-wrap {
    flex: 1;
    position: relative;
  }
  .input-wrap input {
    width: 100%;
    background: var(--surface);
    border: 1px solid rgba(56,189,248,0.2);
    border-radius: 12px;
    padding: 14px 50px 14px 18px;
    color: var(--text);
    font-family: 'DM Mono', monospace;
    font-size: 0.9rem;
    outline: none;
    transition: border-color 0.2s;
  }
  .input-wrap input:focus { border-color: var(--water); }
  .input-unit {
    position: absolute;
    right: 16px; top: 50%;
    transform: translateY(-50%);
    color: var(--muted);
    font-size: 0.75rem;
  }
  .btn-add {
    background: linear-gradient(135deg, var(--water-deep), var(--water));
    border: none;
    border-radius: 12px;
    padding: 14px 24px;
    color: #fff;
    font-family: 'DM Mono', monospace;
    font-size: 0.85rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.25s;
    letter-spacing: 0.5px;
    box-shadow: 0 4px 20px rgba(14,165,233,0.3);
  }
  .btn-add:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(14,165,233,0.45);
  }
  .btn-add:active { transform: scale(0.97); }

  /* Log */
  .log-section { margin-bottom: 32px; }
  .log-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
    max-height: 280px;
    overflow-y: auto;
    padding-right: 4px;
  }
  .log-list::-webkit-scrollbar { width: 4px; }
  .log-list::-webkit-scrollbar-track { background: transparent; }
  .log-list::-webkit-scrollbar-thumb { background: rgba(56,189,248,0.2); border-radius: 4px; }

  .log-item {
    background: var(--surface);
    border: 1px solid rgba(56,189,248,0.08);
    border-radius: 10px;
    padding: 12px 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    animation: slideIn 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  @keyframes slideIn {
    from { opacity: 0; transform: translateX(-20px); }
    to { opacity: 1; transform: translateX(0); }
  }
  .log-left { display: flex; align-items: center; gap: 12px; }
  .log-icon { font-size: 1rem; }
  .log-time { font-size: 0.68rem; color: var(--muted); }
  .log-amount { font-size: 0.95rem; font-weight: 500; color: var(--water); }
  .btn-delete {
    background: transparent;
    border: none;
    color: var(--muted);
    cursor: pointer;
    font-size: 0.85rem;
    padding: 4px;
    transition: color 0.2s;
    font-family: inherit;
  }
  .btn-delete:hover { color: var(--danger); }

  .empty-log {
    text-align: center;
    padding: 32px;
    color: var(--muted);
    font-size: 0.8rem;
    line-height: 1.6;
  }

  /* Reset */
  .footer {
    text-align: center;
    margin-top: 16px;
  }
  .btn-reset {
    background: transparent;
    border: 1px solid rgba(248,113,113,0.2);
    border-radius: 10px;
    padding: 10px 24px;
    color: rgba(248,113,113,0.6);
    font-family: 'DM Mono', monospace;
    font-size: 0.72rem;
    letter-spacing: 1px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .btn-reset:hover {
    border-color: var(--danger);
    color: var(--danger);
    background: rgba(248,113,113,0.08);
  }

  /* Notification permission */
  .notif-bar {
    background: rgba(244,200,66,0.08);
    border: 1px solid rgba(244,200,66,0.25);
    border-radius: 12px;
    padding: 14px 18px;
    margin-bottom: 24px;
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 0.78rem;
    color: #fde68a;
  }
  .notif-bar button {
    margin-left: auto;
    background: rgba(244,200,66,0.2);
    border: 1px solid rgba(244,200,66,0.4);
    border-radius: 8px;
    padding: 6px 14px;
    color: var(--gold);
    font-family: 'DM Mono', monospace;
    font-size: 0.72rem;
    cursor: pointer;
    white-space: nowrap;
    transition: all 0.2s;
  }
  .notif-bar button:hover { background: rgba(244,200,66,0.35); }

  /* Confetti burst */
  .confetti-container {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
    z-index: 999;
  }

  /* Ripple on add */
  @keyframes ripple {
    from { transform: scale(0.5); opacity: 0.8; }
    to { transform: scale(3); opacity: 0; }
  }
</style>
</head>
<body>
<div class="container">
  <header>
    <span class="header-icon">üíß</span>
    <h1>Stay <em>Hydrated</em></h1>
    <p class="date-label" id="dateLabel"></p>
  </header>

  <!-- Notification bar -->
  <div class="notif-bar" id="notifBar" style="display:none">
    üîî Enable reminders to get hourly hydration nudges
    <button onclick="requestNotifs()">Enable</button>
  </div>

  <!-- Goal setter -->
  <div class="goal-section">
    <div>
      <div class="goal-label">Daily Goal</div>
      <div class="goal-display" id="goalDisplay">2.5 L</div>
    </div>
    <div class="goal-controls">
      <button class="btn-small" onclick="adjustGoal(-0.25)">‚àí</button>
      <button class="btn-small" onclick="adjustGoal(0.25)">+</button>
    </div>
  </div>

  <!-- Tank visualization -->
  <div class="tank-wrapper">
    <div class="tank" id="tank">
      <div class="water-fill" id="waterFill" style="height:0%">
        <div class="wave"></div>
        <div class="wave wave2"></div>
      </div>
      <div class="tank-percent" id="tankPercent">0%</div>
      <div class="tank-liters" id="tankLiters">0.0 / 2.5 L</div>
    </div>
  </div>

  <!-- Reminder banner -->
  <div class="reminder-banner" id="reminderBanner">
    <span class="banner-icon" id="bannerIcon">üíß</span>
    <span id="bannerText"></span>
  </div>

  <!-- Stats -->
  <div class="stats">
    <div class="stat-card">
      <div class="stat-value blue" id="statDrank">0.0 L</div>
      <div class="stat-label">Consumed</div>
    </div>
    <div class="stat-card">
      <div class="stat-value gold" id="statRemaining">2.5 L</div>
      <div class="stat-label">Remaining</div>
    </div>
    <div class="stat-card">
      <div class="stat-value green" id="statGlasses">0</div>
      <div class="stat-label">Glasses (250ml)</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="statPercent" style="color:var(--muted)">0%</div>
      <div class="stat-label">Goal Progress</div>
    </div>
  </div>

  <!-- Quick add -->
  <div class="section-title">Quick Add</div>
  <div class="quick-grid">
    <button class="quick-btn" onclick="addWater(0.1)"><span class="amount">100</span>ml<br>Sip</button>
    <button class="quick-btn" onclick="addWater(0.25)"><span class="amount">250</span>ml<br>Glass</button>
    <button class="quick-btn" onclick="addWater(0.5)"><span class="amount">500</span>ml<br>Bottle</button>
    <button class="quick-btn" onclick="addWater(1.0)"><span class="amount">1.0</span>L<br>Large</button>
  </div>

  <!-- Custom input -->
  <div class="custom-row">
    <div class="input-wrap">
      <input type="number" id="customInput" placeholder="0.00" min="0.05" max="2" step="0.05">
      <span class="input-unit">L</span>
    </div>
    <button class="btn-add" onclick="addCustom()">+ Add</button>
  </div>

  <!-- Log -->
  <div class="log-section">
    <div class="section-title">Today's Log</div>
    <div class="log-list" id="logList">
      <div class="empty-log">No water logged yet.<br>Start drinking! üíß</div>
    </div>
  </div>

  <div class="footer">
    <button class="btn-reset" onclick="confirmReset()">‚Ü∫ Reset Today</button>
  </div>
</div>

<div class="confetti-container" id="confettiContainer"></div>

<script>
  // State
  let state = {
    goal: 2.5,
    total: 0,
    log: [],
    goalReached: false,
    reminderInterval: null,
    notifGranted: false,
    lastNotifTime: null
  };

  // Load from localStorage
  function load() {
    const today = new Date().toDateString();
    const saved = JSON.parse(localStorage.getItem('hydrate_v2') || '{}');
    if (saved.date === today) {
      state.total = saved.total || 0;
      state.log = saved.log || [];
      state.goalReached = saved.goalReached || false;
      state.goal = saved.goal || 2.5;
    } else {
      // New day reset
      state.total = 0; state.log = []; state.goalReached = false;
      state.goal = saved.goal || 2.5;
    }
  }

  function save() {
    localStorage.setItem('hydrate_v2', JSON.stringify({
      date: new Date().toDateString(),
      total: state.total,
      log: state.log,
      goalReached: state.goalReached,
      goal: state.goal
    }));
  }

  // Date label
  function updateDateLabel() {
    const d = new Date();
    document.getElementById('dateLabel').textContent =
      d.toLocaleDateString('en-US', { weekday:'long', month:'long', day:'numeric', year:'numeric' });
  }

  // UI update
  function updateUI() {
    const pct = Math.min((state.total / state.goal) * 100, 100);
    const remaining = Math.max(state.goal - state.total, 0);
    const glasses = Math.round(state.total / 0.25);

    // Tank
    document.getElementById('waterFill').style.height = pct + '%';
    document.getElementById('tankPercent').textContent = Math.round(pct) + '%';
    document.getElementById('tankLiters').textContent =
      state.total.toFixed(2) + ' / ' + state.goal.toFixed(2) + ' L';

    // Stats
    document.getElementById('statDrank').textContent = state.total.toFixed(2) + ' L';
    document.getElementById('statRemaining').textContent = remaining.toFixed(2) + ' L';
    document.getElementById('statGlasses').textContent = glasses;
    document.getElementById('statPercent').textContent = Math.round(pct) + '%';

    // Color of percent
    const el = document.getElementById('statPercent');
    if (pct >= 100) el.style.color = 'var(--success)';
    else if (pct >= 60) el.style.color = 'var(--water)';
    else if (pct >= 30) el.style.color = 'var(--gold)';
    else el.style.color = 'var(--danger)';

    // Goal display
    document.getElementById('goalDisplay').textContent = state.goal.toFixed(2) + ' L';

    // Banner
    updateBanner(pct, remaining);

    // Log
    renderLog();

    // Bubbles
    updateBubbles(pct);
  }

  function updateBanner(pct, remaining) {
    const banner = document.getElementById('reminderBanner');
    const icon = document.getElementById('bannerIcon');
    const text = document.getElementById('bannerText');

    let msg, type;
    if (pct >= 100) {
      msg = "üéâ Goal reached! You've hit your daily target. Amazing work!";
      icon.textContent = 'üèÜ';
      type = 'ok';
    } else if (pct === 0) {
      msg = "Start your day with a glass of water ‚Äî your body thanks you.";
      icon.textContent = 'üíß';
      type = 'neutral';
    } else if (pct < 30) {
      msg = `Only ${Math.round(pct)}% done. You need ${remaining.toFixed(2)} L more ‚Äî drink up!`;
      icon.textContent = 'üö®';
      type = 'warn';
    } else if (pct < 70) {
      msg = `${Math.round(pct)}% there! Keep going ‚Äî ${remaining.toFixed(2)} L left to hit your goal.`;
      icon.textContent = '‚ö°';
      type = 'neutral';
    } else {
      msg = `Almost there! Just ${remaining.toFixed(2)} L to complete your goal. You've got this!`;
      icon.textContent = 'üåä';
      type = 'ok';
    }

    text.textContent = msg;
    banner.className = 'reminder-banner show ' + type;
  }

  function renderLog() {
    const list = document.getElementById('logList');
    if (state.log.length === 0) {
      list.innerHTML = '<div class="empty-log">No water logged yet.<br>Start drinking! üíß</div>';
      return;
    }
    list.innerHTML = [...state.log].reverse().map((item, i) => `
      <div class="log-item">
        <div class="log-left">
          <span class="log-icon">${item.icon || 'üíß'}</span>
          <div>
            <div class="log-amount">+${item.amount.toFixed(2)} L</div>
            <div class="log-time">${item.time}</div>
          </div>
        </div>
        <button class="btn-delete" onclick="deleteLog(${state.log.length - 1 - i})">‚úï</button>
      </div>
    `).join('');
  }

  function updateBubbles(pct) {
    const fill = document.getElementById('waterFill');
    const existing = fill.querySelectorAll('.bubble');
    existing.forEach(b => b.remove());
    if (pct < 5) return;
    const count = Math.floor(pct / 20) + 1;
    for (let i = 0; i < count; i++) {
      const b = document.createElement('div');
      b.className = 'bubble';
      const size = 4 + Math.random() * 8;
      b.style.cssText = `
        width:${size}px; height:${size}px;
        left:${10 + Math.random() * 80}%;
        bottom:${Math.random() * 80}%;
        animation-duration:${2 + Math.random() * 3}s;
        animation-delay:${Math.random() * 2}s;
      `;
      fill.appendChild(b);
    }
  }

  // Add water
  function addWater(liters, icon = 'üíß') {
    state.total = Math.round((state.total + liters) * 1000) / 1000;
    const now = new Date();
    state.log.push({
      amount: liters,
      time: now.toLocaleTimeString('en-US', { hour:'2-digit', minute:'2-digit' }),
      icon
    });

    // Check goal
    if (!state.goalReached && state.total >= state.goal) {
      state.goalReached = true;
      launchConfetti();
      sendNotification('üèÜ Goal Reached!', `You've completed your daily water goal of ${state.goal} L!`);
    } else {
      sendReminder();
    }

    save();
    updateUI();
    animateTank();
  }

  function addCustom() {
    const val = parseFloat(document.getElementById('customInput').value);
    if (!val || val <= 0 || val > 5) {
      document.getElementById('customInput').style.borderColor = 'var(--danger)';
      setTimeout(() => document.getElementById('customInput').style.borderColor = '', 1000);
      return;
    }
    addWater(Math.round(val * 100) / 100);
    document.getElementById('customInput').value = '';
  }

  function deleteLog(index) {
    const item = state.log[index];
    state.total = Math.max(0, Math.round((state.total - item.amount) * 1000) / 1000);
    if (state.total < state.goal) state.goalReached = false;
    state.log.splice(index, 1);
    save();
    updateUI();
  }

  function adjustGoal(delta) {
    state.goal = Math.round(Math.max(0.5, Math.min(5, state.goal + delta)) * 100) / 100;
    save();
    updateUI();
  }

  function animateTank() {
    const tank = document.getElementById('tank');
    tank.style.boxShadow = '0 0 60px rgba(56,189,248,0.4), inset 0 0 40px rgba(0,0,0,0.3)';
    setTimeout(() => {
      tank.style.boxShadow = '0 0 40px rgba(56,189,248,0.1), inset 0 0 40px rgba(0,0,0,0.3)';
    }, 600);
  }

  function confirmReset() {
    if (confirm('Reset today\'s water log?')) {
      state.total = 0;
      state.log = [];
      state.goalReached = false;
      save();
      updateUI();
    }
  }

  // Confetti
  function launchConfetti() {
    const container = document.getElementById('confettiContainer');
    const colors = ['#38bdf8','#34d399','#f4c842','#a78bfa','#fb7185'];
    for (let i = 0; i < 80; i++) {
      const p = document.createElement('div');
      const size = 6 + Math.random() * 8;
      p.style.cssText = `
        position:absolute;
        width:${size}px; height:${size}px;
        background:${colors[Math.floor(Math.random()*colors.length)]};
        left:${Math.random()*100}%;
        top:-10px;
        border-radius:${Math.random()>0.5?'50%':'2px'};
        animation:confettiFall ${1.5+Math.random()*2}s ease-in forwards;
        animation-delay:${Math.random()*0.8}s;
        transform:rotate(${Math.random()*360}deg);
      `;
      container.appendChild(p);
    }
    setTimeout(() => container.innerHTML = '', 4000);

    const style = document.createElement('style');
    style.textContent = `@keyframes confettiFall {
      to { transform: translateY(110vh) rotate(720deg); opacity:0; }
    }`;
    document.head.appendChild(style);
  }

  // Notifications
  function requestNotifs() {
    if ('Notification' in window) {
      Notification.requestPermission().then(perm => {
        if (perm === 'granted') {
          state.notifGranted = true;
          document.getElementById('notifBar').style.display = 'none';
          startHourlyReminder();
          new Notification('Hydrate üíß', { body: 'Notifications enabled! I\'ll remind you to drink water.' });
        }
      });
    }
  }

  function sendNotification(title, body) {
    if (state.notifGranted && Notification.permission === 'granted') {
      new Notification(title, { body, icon: 'üíß' });
    }
  }

  function sendReminder() {
    const now = Date.now();
    if (!state.lastNotifTime || now - state.lastNotifTime > 3600000) {
      const remaining = Math.max(state.goal - state.total, 0);
      if (remaining > 0) {
        sendNotification('üíß Hydration Reminder', `You've had ${state.total.toFixed(2)} L. ${remaining.toFixed(2)} L left to reach your goal!`);
        state.lastNotifTime = now;
      }
    }
  }

  function startHourlyReminder() {
    if (state.reminderInterval) clearInterval(state.reminderInterval);
    state.reminderInterval = setInterval(() => {
      if (!state.goalReached) {
        const remaining = Math.max(state.goal - state.total, 0);
        sendNotification('‚è∞ Time to Hydrate!', `${remaining.toFixed(2)} L remaining for today. Grab a glass!`);
      }
    }, 3600000);
  }

  function checkNotifPermission() {
    if ('Notification' in window) {
      if (Notification.permission === 'granted') {
        state.notifGranted = true;
        startHourlyReminder();
      } else if (Notification.permission !== 'denied') {
        document.getElementById('notifBar').style.display = 'flex';
      }
    }
  }

  // Custom input enter key
  document.getElementById('customInput').addEventListener('keydown', e => {
    if (e.key === 'Enter') addCustom();
  });

  // Init
  load();
  updateDateLabel();
  updateUI();
  checkNotifPermission();
</script>
</body>
</html>
